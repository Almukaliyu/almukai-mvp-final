import { connect } from '@/lib/mongoose'; import User from '@/models/User'; import bcrypt from 'bcryptjs'; import { serialize } from 'cookie'; export default async function handler(req,res){ if(req.method!=='POST') return res.status(405).end(); const { email,password } = req.body; await connect(); const user = await User.findOne({ email }); if(!user) return res.status(400).json({ error:'Invalid' }); if(!bcrypt.compareSync(password, user.password)) return res.status(400).json({ error:'Invalid' }); res.setHeader('Set-Cookie', serialize('almukai_uid', String(user._id), { path:'/', httpOnly:true })); res.json({ user: { id: user._id, email: user.email, credits: user.credits } }); }
