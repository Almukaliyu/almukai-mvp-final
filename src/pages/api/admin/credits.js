import { connect } from '@/lib/mongoose'; import User from '@/models/User'; import cookie from 'cookie'; export default async function handler(req,res){ if(req.method!=='POST') return res.status(405).end(); const cookies = cookie.parse(req.headers.cookie || ''); if(!cookies.almukai_admin) return res.status(401).json({ error:'Unauthorized' }); await connect(); const { id, amount } = req.body; const user = await User.findById(id); if(!user) return res.status(400).json({ error:'User not found' }); user.credits = (user.credits||0) + (amount||0); await user.save(); res.json({ ok:true }); }
