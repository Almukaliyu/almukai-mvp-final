import { connect } from '@/lib/mongoose'; import User from '@/models/User'; function stubAnswer(p){ const t=(p||'').toLowerCase(); if(!t) return 'Ask me anything.'; if(t.includes('mil')) return 'MIL tip: verify sources and check dates.'; if(t.includes('career')) return 'Career tip: build projects and share them.'; return 'Try breaking the task into 3 steps and set a 7-day goal.'; } export default async function handler(req,res){ if(req.method!=='POST') return res.status(405).end(); await connect(); const cookies = req.headers.cookie||''; const match = cookies.match(/almukai_uid=(\w+)/); const id = match? match[1] : null; if(!id) return res.status(400).json({ error:'Login required' }); const user = await User.findById(id); if(!user) return res.status(400).json({ error:'Not found' }); if((user.credits||0)<=0) return res.status(400).json({ error:'Out of credits' }); const { prompt } = req.body; const answer = stubAnswer(prompt); user.credits = Math.max(0,(user.credits||0)-1); await user.save(); res.json({ answer, credits: user.credits }); }
